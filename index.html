<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§  AI æ•™å­¸ç›®æ¨™ç”¢ç”Ÿå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1.5fr 1fr;
            gap: 30px;
            padding: 30px;
            min-height: 600px;
        }

        .input-section {
            background: #f8faff;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e1e8ff;
        }

        .input-section h3 {
            color: #4facfe;
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ff;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4facfe;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .generate-btn {
            width: 100%;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
        }

        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .display-section {
            background: #fff;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e8e8e8;
        }

        .display-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .goal-item {
            background: #f9f9f9;
            border-left: 4px solid #4facfe;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 0 10px 10px 0;
            position: relative;
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .goal-type {
            font-weight: 600;
            color: #4facfe;
            font-size: 1.1em;
        }

        .bloom-tag {
            background: #e1f5fe;
            color: #0277bd;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
        }

        .goal-content {
            color: #555;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .goal-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            background: #f0f0f0;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.2s;
        }

        .action-btn:hover {
            background: #e0e0e0;
        }

        .info-section {
            background: #f0f8ff;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e1e8ff;
        }

        .info-section h3 {
            color: #4facfe;
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .competency-list {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .competency-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .competency-item:last-child {
            border-bottom: none;
        }

        .competency-code {
            background: #4facfe;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .export-section {
            background: white;
            border-radius: 10px;
            padding: 15px;
        }

        .export-btn {
            width: 100%;
            background: #28a745;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        .export-btn:hover {
            background: #218838;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4facfe;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state img {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid #c3e6cb;
            display: none;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§  AI æ•™å­¸ç›®æ¨™ç”¢ç”Ÿå™¨</h1>
            <p>å¿«é€Ÿç”¢ç”Ÿç¬¦åˆèª²ç¶±çš„æ˜ç¢ºæ•™å­¸ç›®æ¨™ï¼Œæå‡å‚™èª²æ•ˆç‡</p>
        </div>

        <div class="main-content">
            <!-- å·¦å´è¼¸å…¥å€ -->
            <div class="input-section">
                <h3>ğŸ“˜ èª²ç¨‹è³‡è¨Šè¼¸å…¥</h3>
                
                <div class="success-message" id="successMessage"></div>
                <div class="error-message" id="errorMessage"></div>

                <form id="courseForm">
                    <div class="form-group">
                        <label for="courseTitle">èª²ç¨‹ä¸»é¡Œ *</label>
                        <input type="text" id="courseTitle" name="courseTitle" 
                               placeholder="ä¾‹ï¼šUnit 1 - Introducing Yourself" required>
                    </div>

                    <div class="form-group">
                        <label for="learningPoints">å­¸ç¿’é‡é» *</label>
                        <textarea id="learningPoints" name="learningPoints" 
                                  placeholder="ä¾‹ï¼šèƒ½ç”¨è‹±æ–‡ä»‹ç´¹å§“åã€å¹´é½¡ã€åœ‹ç±" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="educationLevel">æ•™è‚²éšæ®µ</label>
                        <select id="educationLevel" name="educationLevel">
                            <option value="elementary">åœ‹å°</option>
                            <option value="junior">åœ‹ä¸­</option>
                            <option value="senior" selected>é«˜ä¸­</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="subject">ç§‘ç›®</label>
                        <select id="subject" name="subject">
                            <option value="chinese">åœ‹æ–‡</option>
                            <option value="english" selected>è‹±æ–‡</option>
                            <option value="math">æ•¸å­¸</option>
                            <option value="science">è‡ªç„¶ç§‘å­¸</option>
                            <option value="social">ç¤¾æœƒ</option>
                            <option value="arts">è—è¡“</option>
                            <option value="pe">é«”è‚²</option>
                            <option value="tech">ç§‘æŠ€</option>
                            <option value="other">å…¶ä»–</option>
                        </select>
                    </div>

                    <button type="submit" class="generate-btn" id="generateBtn">
                        âœ¨ ç”¢ç”Ÿæ•™å­¸ç›®æ¨™
                    </button>
                </form>
            </div>

            <!-- ä¸­å¤®é¡¯ç¤ºå€ -->
            <div class="display-section">
                <h3>ğŸ“‹ æ•™å­¸ç›®æ¨™</h3>
                
                <div class="loading" id="loadingDiv">
                    <div class="spinner"></div>
                    <p>AI æ­£åœ¨ç‚ºæ‚¨ç”¢ç”Ÿæ•™å­¸ç›®æ¨™...</p>
                </div>

                <div class="empty-state" id="emptyState">
                    <div style="font-size: 4em; margin-bottom: 20px;">ğŸ“</div>
                    <h4>å°šæœªç”¢ç”Ÿæ•™å­¸ç›®æ¨™</h4>
                    <p>è«‹åœ¨å·¦å´è¼¸å…¥èª²ç¨‹è³‡è¨Šï¼Œé»æ“Šã€Œç”¢ç”Ÿæ•™å­¸ç›®æ¨™ã€é–‹å§‹ä½¿ç”¨</p>
                </div>

                <div id="goalsContainer" style="display: none;">
                    <div class="goal-item" id="cognitiveGoal">
                        <div class="goal-header">
                            <div class="goal-type">ğŸ§  èªçŸ¥å±¤é¢</div>
                            <div class="bloom-tag" id="cognitiveBloom">ç†è§£</div>
                        </div>
                        <div class="goal-content" id="cognitiveContent">
                            å­¸ç”Ÿèƒ½ç†è§£ä»‹ç´¹è‡ªæˆ‘èˆ‡åœ‹ç±çš„åŸºæœ¬å¥å‹
                        </div>
                        <div class="goal-actions">
                            <button class="action-btn" onclick="editGoal('cognitive')">âœï¸ ç·¨è¼¯</button>
                            <button class="action-btn" onclick="regenerateGoal('cognitive')">ğŸ” é‡æ–°ç”¢ç”Ÿ</button>
                        </div>
                    </div>

                    <div class="goal-item" id="skillGoal">
                        <div class="goal-header">
                            <div class="goal-type">ğŸ› ï¸ æŠ€èƒ½å±¤é¢</div>
                            <div class="bloom-tag" id="skillBloom">æ‡‰ç”¨</div>
                        </div>
                        <div class="goal-content" id="skillContent">
                            å­¸ç”Ÿèƒ½ç”¨è‹±æ–‡æ­£ç¢ºä»‹ç´¹è‡ªå·±çš„åœ‹ç±èˆ‡èƒŒæ™¯
                        </div>
                        <div class="goal-actions">
                            <button class="action-btn" onclick="editGoal('skill')">âœï¸ ç·¨è¼¯</button>
                            <button class="action-btn" onclick="regenerateGoal('skill')">ğŸ” é‡æ–°ç”¢ç”Ÿ</button>
                        </div>
                    </div>

                    <div class="goal-item" id="affectiveGoal">
                        <div class="goal-header">
                            <div class="goal-type">â¤ï¸ æƒ…æ„å±¤é¢</div>
                            <div class="bloom-tag" id="affectiveBloom">è©•é‘‘</div>
                        </div>
                        <div class="goal-content" id="affectiveContent">
                            å­¸ç”Ÿèƒ½æ¨‚æ–¼èˆ‡ä»–äººäº’å‹•ä¸¦è¡¨é”è‡ªæˆ‘
                        </div>
                        <div class="goal-actions">
                            <button class="action-btn" onclick="editGoal('affective')">âœï¸ ç·¨è¼¯</button>
                            <button class="action-btn" onclick="regenerateGoal('affective')">ğŸ” é‡æ–°ç”¢ç”Ÿ</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³å´è³‡è¨Šæ¬„ -->
            <div class="info-section">
                <h3>ğŸ§© æ ¸å¿ƒç´ é¤Šå°æ‡‰</h3>
                
                <div class="competency-list" id="competencyList">
                    <div class="competency-item">
                        <span>è‡ªä¸»è¡Œå‹•</span>
                        <span class="competency-code">A1</span>
                    </div>
                    <div class="competency-item">
                        <span>æºé€šäº’å‹•</span>
                        <span class="competency-code">B1</span>
                    </div>
                    <div class="competency-item">
                        <span>ç¤¾æœƒåƒèˆ‡</span>
                        <span class="competency-code">C2</span>
                    </div>
                </div>

                <div class="export-section">
                    <h4 style="margin-bottom: 15px; color: #333;">ğŸ“¤ åŒ¯å‡ºåŠŸèƒ½</h4>
                    <button class="export-btn" onclick="copyToClipboard()">ğŸ“‹ è¤‡è£½åˆ°å‰ªè²¼ç°¿</button>
                    <button class="export-btn" onclick="exportToWord()">ğŸ“„ ä¸‹è¼‰ Word æª”</button>
                    <button class="export-btn" onclick="exportToPDF()">ğŸ“‘ ä¸‹è¼‰ PDF æª”</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let currentGoals = {
            cognitive: '',
            skill: '',
            affective: ''
        };

        // Bloom's èªçŸ¥å±¤ç´šå°æ‡‰
        const bloomLevels = {
            cognitive: ['è¨˜æ†¶', 'ç†è§£', 'æ‡‰ç”¨', 'åˆ†æ'],
            skill: ['æ‡‰ç”¨', 'åˆ†æ', 'è©•é‘‘', 'å‰µé€ '],
            affective: ['æ¥å—', 'åæ‡‰', 'è©•åƒ¹', 'çµ„ç¹”', 'å…§åŒ–']
        };

        // æ ¸å¿ƒç´ é¤Šå°æ‡‰è¡¨
        const competencyMapping = {
            elementary: {
                chinese: ['A1', 'B1', 'C1'],
                english: ['A1', 'B1', 'C2'],
                math: ['A2', 'B1', 'C1'],
                science: ['A2', 'B2', 'C1'],
                social: ['A1', 'B3', 'C3'],
                arts: ['A1', 'B3', 'C2'],
                pe: ['A1', 'B2', 'C2'],
                tech: ['A2', 'B2', 'C1'],
                other: ['A1', 'B1', 'C1']
            },
            junior: {
                chinese: ['A1', 'B1', 'C1'],
                english: ['A1', 'B1', 'C2'],
                math: ['A2', 'B1', 'C1'],
                science: ['A2', 'B2', 'C1'],
                social: ['A1', 'B3', 'C3'],
                arts: ['A1', 'B3', 'C2'],
                pe: ['A1', 'B2', 'C2'],
                tech: ['A2', 'B2', 'C1'],
                other: ['A1', 'B1', 'C1']
            },
            senior: {
                chinese: ['A1', 'B1', 'C1'],
                english: ['A1', 'B1', 'C2'],
                math: ['A2', 'B1', 'C1'],
                science: ['A2', 'B2', 'C1'],
                social: ['A1', 'B3', 'C3'],
                arts: ['A1', 'B3', 'C2'],
                pe: ['A1', 'B2', 'C2'],
                tech: ['A2', 'B2', 'C1'],
                other: ['A1', 'B1', 'C1']
            }
        };

        // è¡¨å–®æäº¤äº‹ä»¶
        document.getElementById('courseForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            await generateGoals();
        });

        // ç”¢ç”Ÿæ•™å­¸ç›®æ¨™ä¸»å‡½æ•¸
        async function generateGoals() {
            const formData = new FormData(document.getElementById('courseForm'));
            const courseTitle = formData.get('courseTitle');
            const learningPoints = formData.get('learningPoints');
            const educationLevel = formData.get('educationLevel');
            const subject = formData.get('subject');

            if (!courseTitle || !learningPoints) {
                showError('è«‹å¡«å¯«å¿…è¦çš„èª²ç¨‹è³‡è¨Š');
                return;
            }

            // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            showLoading(true);
            hideError();

            try {
                // ä½¿ç”¨ Hugging Face API ç”¢ç”Ÿç›®æ¨™
                const prompt = buildPrompt(courseTitle, learningPoints, educationLevel, subject);
                const aiResponse = await callHuggingFaceAPI(prompt);
                
                // è§£æ AI å›æ‡‰ï¼ˆé€™è£¡å‡è¨­ AI è¿”å›æ ¼å¼åŒ–çš„æ–‡å­—ï¼Œå¯¦éš›å¯èƒ½éœ€æ›´è¤‡é›œè§£æï¼‰
                const goals = parseAIResponse(aiResponse);
                
                // æ›´æ–°é¡¯ç¤º
                updateGoalsDisplay(goals);
                updateCompetencyMapping(educationLevel, subject);
                
                showSuccess('æ•™å­¸ç›®æ¨™å·²æˆåŠŸç”¢ç”Ÿï¼');
                
            } catch (error) {
                console.error('ç”Ÿæˆå¤±æ•—:', error);
                showError('ç”Ÿæˆæ•™å­¸ç›®æ¨™æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦');
            } finally {
                showLoading(false);
            }
        }

        // è§£æ AI å›æ‡‰ï¼ˆç°¡åŒ–è™•ç†ï¼Œå¯¦éš›éœ€æ ¹æ“šæ¨¡å‹å›æ‡‰èª¿æ•´ï¼‰
        function parseAIResponse(response) {
            // å‡è¨­ AI è¿”å›é¡ä¼¼æ ¼å¼çš„æ–‡å­—ï¼Œå¯¦éš›éœ€æ ¹æ“šæ¨¡å‹èª¿æ•´
            const lines = response.split('\n').filter(line => line.trim());
            return {
                cognitive: lines.find(line => line.startsWith('èªçŸ¥:'))?.replace('èªçŸ¥:', '').trim() || 'å­¸ç”Ÿèƒ½ç†è§£èª²ç¨‹æ ¸å¿ƒæ¦‚å¿µ',
                skill: lines.find(line => line.startsWith('æŠ€èƒ½:'))?.replace('æŠ€èƒ½:', '').trim() || 'å­¸ç”Ÿèƒ½æ‡‰ç”¨æ‰€å­¸è§£æ±ºå•é¡Œ',
                affective: lines.find(line => line.startsWith('æƒ…æ„:'))?.replace('æƒ…æ„:', '').trim() || 'å­¸ç”Ÿèƒ½å±•ç¾ç©æ¥µå­¸ç¿’æ…‹åº¦'
            };
        }

        // æ›´æ–°ç›®æ¨™é¡¯ç¤º
        function updateGoalsDisplay(goals) {
            currentGoals = goals;
            
            document.getElementById('cognitiveContent').textContent = goals.cognitive;
            document.getElementById('skillContent').textContent = goals.skill;
            document.getElementById('affectiveContent').textContent = goals.affective;

            // éš¨æ©Ÿåˆ†é… Bloom's å±¤ç´šï¼ˆå¯¦éš›æ‡‰è©²ç”± AI åˆ†ææ±ºå®šï¼‰
            document.getElementById('cognitiveBloom').textContent = 
                bloomLevels.cognitive[Math.floor(Math.random() * bloomLevels.cognitive.length)];
            document.getElementById('skillBloom').textContent = 
                bloomLevels.skill[Math.floor(Math.random() * bloomLevels.skill.length)];
            document.getElementById('affectiveBloom').textContent = 
                bloomLevels.affective[Math.floor(Math.random() * bloomLevels.affective.length)];

            // é¡¯ç¤ºçµæœå€åŸŸ
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('goalsContainer').style.display = 'block';
        }

        // æ›´æ–°æ ¸å¿ƒç´ é¤Šå°æ‡‰
        function updateCompetencyMapping(level, subject) {
            const competencies = competencyMapping[level][subject];
            const competencyNames = {
                'A1': 'èº«å¿ƒç´ è³ªèˆ‡è‡ªæˆ‘ç²¾é€²',
                'A2': 'ç³»çµ±æ€è€ƒèˆ‡å•é¡Œè§£æ±º',
                'A3': 'è¦åŠƒåŸ·è¡Œèˆ‡å‰µæ–°æ‡‰è®Š',
                'B1': 'ç¬¦è™Ÿé‹ç”¨èˆ‡æºé€šè¡¨é”',
                'B2': 'ç§‘æŠ€è³‡è¨Šèˆ‡åª’é«”ç´ é¤Š',
                'B3': 'è—è¡“æ¶µé¤Šèˆ‡ç¾æ„Ÿç´ é¤Š',
                'C1': 'é“å¾·å¯¦è¸èˆ‡å…¬æ°‘æ„è­˜',
                'C2': 'äººéš›é—œä¿‚èˆ‡åœ˜éšŠåˆä½œ',
                'C3': 'å¤šå…ƒæ–‡åŒ–èˆ‡åœ‹éš›ç†è§£'
            };

            const competencyList = document.getElementById('competencyList');
            competencyList.innerHTML = '';

            competencies.forEach(code => {
                const item = document.createElement('div');
                item.className = 'competency-item';
                item.innerHTML = `
                    <span>${competencyNames[code]}</span>
                    <span class="competency-code">${code}</span>
                `;
                competencyList.appendChild(item);
            });
        }

        // ç·¨è¼¯ç›®æ¨™
        function editGoal(type) {
            const contentElement = document.getElementById(`${type}Content`);
            const currentText = contentElement.textContent;
            
            const newText = prompt(`ç·¨è¼¯${type === 'cognitive' ? 'èªçŸ¥' : type === 'skill' ? 'æŠ€èƒ½' : 'æƒ…æ„'}å±¤é¢ç›®æ¨™:`, currentText);
            
            if (newText && newText !== currentText) {
                contentElement.textContent = newText;
                currentGoals[type] = newText;
                showSuccess('ç›®æ¨™å·²æ›´æ–°ï¼');
            }
        }

        // é‡æ–°ç”¢ç”Ÿå€‹åˆ¥ç›®æ¨™
        async function regenerateGoal(type) {
            const contentElement = document.getElementById(`${type}Content`);
            const originalText = contentElement.textContent;
            
            contentElement.textContent = 'é‡æ–°ç”¢ç”Ÿä¸­...';
            
            try {
                // ä½¿ç”¨ Hugging Face API é‡æ–°ç”¢ç”Ÿå–®ä¸€ç›®æ¨™
                const formData = new FormData(document.getElementById('courseForm'));
                const prompt = buildPrompt(
                    formData.get('courseTitle'),
                    formData.get('learningPoints'),
                    formData.get('educationLevel'),
                    formData.get('subject')
                );
                const aiResponse = await callHuggingFaceAPI(prompt);
                const newGoal = parseAIResponse(aiResponse)[type];
                
                contentElement.textContent = newGoal;
                currentGoals[type] = newGoal;
                
                showSuccess(`${type === 'cognitive' ? 'èªçŸ¥' : type === 'skill' ? 'æŠ€èƒ½' : 'æƒ…æ„'}å±¤é¢ç›®æ¨™å·²é‡æ–°ç”¢ç”Ÿï¼`);
                
            } catch (error) {
                contentElement.textContent = originalText;
                showError('é‡æ–°ç”¢ç”Ÿå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
            }
        }

        // è¤‡è£½åˆ°å‰ªè²¼ç°¿
        async function copyToClipboard() {
            const text = formatGoalsForExport();
            
            try {
                await navigator.clipboard.writeText(text);
                showSuccess('æ•™å­¸ç›®æ¨™å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
            } catch (error) {
                showError('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–æ–‡å­—è¤‡è£½');
            }
        }

        // åŒ¯å‡ºç‚º Word
        function exportToWord() {
            const content = formatGoalsForExport();
            const blob = new Blob([content], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'æ•™å­¸ç›®æ¨™.doc';
            link.click();
            
            URL.revokeObjectURL(url);
            showSuccess('Word æª”æ¡ˆå·²é–‹å§‹ä¸‹è¼‰ï¼');
        }

        // åŒ¯å‡ºç‚º PDF
        function exportToPDF() {
            showError('PDF åŒ¯å‡ºåŠŸèƒ½é–‹ç™¼ä¸­ï¼Œè«‹å…ˆä½¿ç”¨è¤‡è£½åŠŸèƒ½');
        }

        // æ ¼å¼åŒ–ç›®æ¨™æ–‡å­—
        function formatGoalsForExport() {
            const formData = new FormData(document.getElementById('courseForm'));
            const courseTitle = formData.get('courseTitle');
            
            return `æ•™å­¸ç›®æ¨™ - ${courseTitle}

èªçŸ¥å±¤é¢ï¼š
${currentGoals.cognitive}

æŠ€èƒ½å±¤é¢ï¼š
${currentGoals.skill}

æƒ…æ„å±¤é¢ï¼š
${currentGoals.affective}

---
ç”¢ç”Ÿæ™‚é–“ï¼š${new Date().toLocaleString('zh-TW')}
ä½¿ç”¨å·¥å…·ï¼šAI æ•™å­¸ç›®æ¨™ç”¢ç”Ÿå™¨`;
        }

        // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
        function showLoading(show) {
            const loadingDiv = document.getElementById('loadingDiv');
            const generateBtn = document.getElementById('generateBtn');
            
            if (show) {
                loadingDiv.classList.add('show');
                generateBtn.disabled = true;
                generateBtn.textContent = 'â³ ç”¢ç”Ÿä¸­...';
            } else {
                loadingDiv.classList.remove('show');
                generateBtn.disabled = false;
                generateBtn.textContent = 'âœ¨ ç”¢ç”Ÿæ•™å­¸ç›®æ¨™';
            }
        }

        // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 3000);
        }

        // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        // éš±è—éŒ¯èª¤è¨Šæ¯
        function hideError() {
            document.getElementById('errorMessage').style.display = 'none';
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateCompetencyMapping('senior', 'english');
            
            document.getElementById('educationLevel').addEventListener('change', function() {
                const level = this.value;
                const subject = document.getElementById('subject').value;
                updateCompetencyMapping(level, subject);
            });

            document.getElementById('subject').addEventListener('change', function() {
                const level = document.getElementById('educationLevel').value;
                const subject = this.value;
                updateCompetencyMapping(level, subject);
            });
        });

        // Hugging Face API æ•´åˆå‡½æ•¸
        async function callHuggingFaceAPI(prompt) {
            try {
                // å¾ Render å¾Œç«¯ç²å– token
                const tokenResponse = await fetch('https://hf-token-backend.onrender.com/api/token');
                if (!tokenResponse.ok) {
                    throw new Error(`ç„¡æ³•ç²å– API token: ${tokenResponse.status}`);
                }
                const { token } = await tokenResponse.json();

                const MODEL_URL = 'https://api-inference.huggingface.co/models/microsoft/DialoGPT-medium';
                const response = await fetch(MODEL_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        inputs: prompt,
                        parameters: {
                            max_length: 200,
                            temperature: 0.7,
                            do_sample: true
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`API è«‹æ±‚å¤±æ•—: ${response.status}`);
                }

                const result = await response.json();
                return result[0].generated_text;

            } catch (error) {
                console.error('Hugging Face API å‘¼å«å¤±æ•—:', error);
                showError('ç”Ÿæˆæ•™å­¸ç›®æ¨™å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–ç¨å¾Œå†è©¦');
                throw error;
            }
        }

        // å»ºæ§‹ AI æç¤ºè©
        function buildPrompt(courseTitle, learningPoints, educationLevel, subject) {
            const levelMap = {
                elementary: 'åœ‹å°',
                junior: 'åœ‹ä¸­', 
                senior: 'é«˜ä¸­'
            };

            const subjectMap = {
                chinese: 'åœ‹æ–‡',
                english: 'è‹±æ–‡',
                math: 'æ•¸å­¸',
                science: 'è‡ªç„¶ç§‘å­¸',
                social: 'ç¤¾æœƒ',
                arts: 'è—è¡“',
                pe: 'é«”è‚²',
                tech: 'ç§‘æŠ€',
                other: 'å…¶ä»–'
            };

            return `è«‹ç‚º${levelMap[educationLevel]}${subjectMap[subject]}èª²ç¨‹ã€Œ${courseTitle}ã€ç”¢ç”Ÿæ•™å­¸ç›®æ¨™ã€‚
å­¸ç¿’é‡é»ï¼š${learningPoints}

è«‹ç”¢ç”Ÿä¸‰å€‹å±¤é¢çš„æ•™å­¸ç›®æ¨™ï¼š
1. èªçŸ¥å±¤é¢ï¼šå­¸ç”Ÿèƒ½ç†è§£ã€åˆ†æã€è¨˜æ†¶çš„çŸ¥è­˜æ€§ç›®æ¨™
2. æŠ€èƒ½å±¤é¢ï¼šå­¸ç”Ÿèƒ½å¯¦éš›æ“ä½œã€æ‡‰ç”¨ã€å‰µé€ çš„èƒ½åŠ›æ€§ç›®æ¨™  
3. æƒ…æ„å±¤é¢ï¼šå­¸ç”Ÿçš„æ…‹åº¦ã€åƒ¹å€¼è§€ã€æƒ…æ„Ÿè¡¨ç¾ç›®æ¨™

æ¯å€‹ç›®æ¨™éƒ½è¦ï¼š
- ä»¥ã€Œå­¸ç”Ÿèƒ½ã€é–‹é ­
- å…·é«”æ˜ç¢ºï¼Œå¯è§€å¯Ÿå¯è©•é‡
- ç¬¦åˆ${levelMap[educationLevel]}å­¸ç”Ÿç¨‹åº¦
- å°æ‡‰é©ç•¶çš„BloomèªçŸ¥å±¤ç´š

è«‹ç”¨ç¹é«”ä¸­æ–‡å›ç­”ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
èªçŸ¥ï¼š[ç›®æ¨™å…§å®¹]
æŠ€èƒ½ï¼š[ç›®æ¨™å…§å®¹] 
æƒ…æ„ï¼š[ç›®æ¨™å…§å®¹]`;
        }
    </script>
</body>
</html>