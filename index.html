<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß† AI ÊïôÂ≠∏ÁõÆÊ®ôÁî¢ÁîüÂô®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1.5fr 1fr;
            gap: 30px;
            padding: 30px;
            min-height: 600px;
        }

        .input-section {
            background: #f8faff;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e1e8ff;
        }

        .input-section h3 {
            color: #4facfe;
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e8ff;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4facfe;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .generate-btn {
            width: 100%;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
        }

        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .display-section {
            background: #fff;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e8e8e8;
        }

        .display-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .goal-item {
            background: #f9f9f9;
            border-left: 4px solid #4facfe;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 0 10px 10px 0;
            position: relative;
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .goal-type {
            font-weight: 600;
            color: #4facfe;
            font-size: 1.1em;
        }

        .bloom-tag {
            background: #e1f5fe;
            color: #0277bd;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
        }

        .goal-content {
            color: #555;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .goal-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            background: #f0f0f0;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.2s;
        }

        .action-btn:hover {
            background: #e0e0e0;
        }

        .info-section {
            background: #f0f8ff;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e1e8ff;
        }

        .info-section h3 {
            color: #4facfe;
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .competency-list {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .competency-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .competency-item:last-child {
            border-bottom: none;
        }

        .competency-code {
            background: #4facfe;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .export-section {
            background: white;
            border-radius: 10px;
            padding: 15px;
        }

        .export-btn {
            width: 100%;
            background: #28a745;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        .export-btn:hover {
            background: #218838;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4facfe;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state img {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid #c3e6cb;
            display: none;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† AI ÊïôÂ≠∏ÁõÆÊ®ôÁî¢ÁîüÂô®</h1>
            <p>Âø´ÈÄüÁî¢ÁîüÁ¨¶ÂêàË™≤Á∂±ÁöÑÊòéÁ¢∫ÊïôÂ≠∏ÁõÆÊ®ôÔºåÊèêÂçáÂÇôË™≤ÊïàÁéá</p>
        </div>

        <div class="main-content">
            <!-- Â∑¶ÂÅ¥Ëº∏ÂÖ•ÂçÄ -->
            <div class="input-section">
                <h3>üìò Ë™≤Á®ãË≥áË®äËº∏ÂÖ•</h3>
                
                <div class="success-message" id="successMessage"></div>
                <div class="error-message" id="errorMessage"></div>

                <form id="courseForm">
                    <div class="form-group">
                        <label for="courseTitle">Ë™≤Á®ã‰∏ªÈ°å *</label>
                        <input type="text" id="courseTitle" name="courseTitle" 
                               placeholder="‰æãÔºöUnit 1 - Introducing Yourself" required>
                    </div>

                    <div class="form-group">
                        <label for="learningPoints">Â≠∏ÁøíÈáçÈªû *</label>
                        <textarea id="learningPoints" name="learningPoints" 
                                  placeholder="‰æãÔºöËÉΩÁî®Ëã±Êñá‰ªãÁ¥πÂßìÂêç„ÄÅÂπ¥ÈΩ°„ÄÅÂúãÁ±ç" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="educationLevel">ÊïôËÇ≤ÈöéÊÆµ</label>
                        <select id="educationLevel" name="educationLevel">
                            <option value="elementary">ÂúãÂ∞è</option>
                            <option value="junior">Âúã‰∏≠</option>
                            <option value="senior" selected>È´ò‰∏≠</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="subject">ÁßëÁõÆ</label>
                        <select id="subject" name="subject">
                            <option value="chinese">ÂúãÊñá</option>
                            <option value="english" selected>Ëã±Êñá</option>
                            <option value="math">Êï∏Â≠∏</option>
                            <option value="science">Ëá™ÁÑ∂ÁßëÂ≠∏</option>
                            <option value="social">Á§æÊúÉ</option>
                            <option value="arts">ËóùË°ì</option>
                            <option value="pe">È´îËÇ≤</option>
                            <option value="tech">ÁßëÊäÄ</option>
                            <option value="other">ÂÖ∂‰ªñ</option>
                        </select>
                    </div>

                    <button type="submit" class="generate-btn" id="generateBtn">
                        ‚ú® Áî¢ÁîüÊïôÂ≠∏ÁõÆÊ®ô
                    </button>
                </form>
            </div>

            <!-- ‰∏≠Â§ÆÈ°ØÁ§∫ÂçÄ -->
            <div class="display-section">
                <h3>üìã ÊïôÂ≠∏ÁõÆÊ®ô</h3>
                
                <div class="loading" id="loadingDiv">
                    <div class="spinner"></div>
                    <p>AI Ê≠£Âú®ÁÇ∫ÊÇ®Áî¢ÁîüÊïôÂ≠∏ÁõÆÊ®ô...</p>
                </div>

                <div class="empty-state" id="emptyState">
                    <div style="font-size: 4em; margin-bottom: 20px;">üìù</div>
                    <h4>Â∞öÊú™Áî¢ÁîüÊïôÂ≠∏ÁõÆÊ®ô</h4>
                    <p>Ë´ãÂú®Â∑¶ÂÅ¥Ëº∏ÂÖ•Ë™≤Á®ãË≥áË®äÔºåÈªûÊìä„ÄåÁî¢ÁîüÊïôÂ≠∏ÁõÆÊ®ô„ÄçÈñãÂßã‰ΩøÁî®</p>
                </div>

                <div id="goalsContainer" style="display: none;">
                    <div class="goal-item" id="cognitiveGoal">
                        <div class="goal-header">
                            <div class="goal-type">üß† Ë™çÁü•Â±§Èù¢</div>
                            <div class="bloom-tag" id="cognitiveBloom">ÁêÜËß£</div>
                        </div>
                        <div class="goal-content" id="cognitiveContent">
                            Â≠∏ÁîüËÉΩÁêÜËß£‰ªãÁ¥πËá™ÊàëËàáÂúãÁ±çÁöÑÂü∫Êú¨Âè•Âûã
                        </div>
                        <div class="goal-actions">
                            <button class="action-btn" onclick="editGoal('cognitive')">‚úèÔ∏è Á∑®ËºØ</button>
                            <button class="action-btn" onclick="regenerateGoal('cognitive')">üîÅ ÈáçÊñ∞Áî¢Áîü</button>
                        </div>
                    </div>

                    <div class="goal-item" id="skillGoal">
                        <div class="goal-header">
                            <div class="goal-type">üõ†Ô∏è ÊäÄËÉΩÂ±§Èù¢</div>
                            <div class="bloom-tag" id="skillBloom">ÊáâÁî®</div>
                        </div>
                        <div class="goal-content" id="skillContent">
                            Â≠∏ÁîüËÉΩÁî®Ëã±ÊñáÊ≠£Á¢∫‰ªãÁ¥πËá™Â∑±ÁöÑÂúãÁ±çËàáËÉåÊôØ
                        </div>
                        <div class="goal-actions">
                            <button class="action-btn" onclick="editGoal('skill')">‚úèÔ∏è Á∑®ËºØ</button>
                            <button class="action-btn" onclick="regenerateGoal('skill')">üîÅ ÈáçÊñ∞Áî¢Áîü</button>
                        </div>
                    </div>

                    <div class="goal-item" id="affectiveGoal">
                        <div class="goal-header">
                            <div class="goal-type">‚ù§Ô∏è ÊÉÖÊÑèÂ±§Èù¢</div>
                            <div class="bloom-tag" id="affectiveBloom">Ë©ïÈëë</div>
                        </div>
                        <div class="goal-content" id="affectiveContent">
                            Â≠∏ÁîüËÉΩÊ®ÇÊñºËàá‰ªñ‰∫∫‰∫íÂãï‰∏¶Ë°®ÈÅîËá™Êàë
                        </div>
                        <div class="goal-actions">
                            <button class="action-btn" onclick="editGoal('affective')">‚úèÔ∏è Á∑®ËºØ</button>
                            <button class="action-btn" onclick="regenerateGoal('affective')">üîÅ ÈáçÊñ∞Áî¢Áîü</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Âè≥ÂÅ¥Ë≥áË®äÊ¨Ñ -->
            <div class="info-section">
                <h3>üß© Ê†∏ÂøÉÁ¥†È§äÂ∞çÊáâ</h3>
                
                <div class="competency-list" id="competencyList">
                    <div class="competency-item">
                        <span>Ëá™‰∏ªË°åÂãï</span>
                        <span class="competency-code">A1</span>
                    </div>
                    <div class="competency-item">
                        <span>Ê∫ùÈÄö‰∫íÂãï</span>
                        <span class="competency-code">B1</span>
                    </div>
                    <div class="competency-item">
                        <span>Á§æÊúÉÂèÉËàá</span>
                        <span class="competency-code">C2</span>
                    </div>
                </div>

                <div class="export-section">
                    <h4 style="margin-bottom: 15px; color: #333;">üì§ ÂåØÂá∫ÂäüËÉΩ</h4>
                    <button class="export-btn" onclick="copyToClipboard()">üìã Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞ø</button>
                    <button class="export-btn" onclick="exportToWord()">üìÑ ‰∏ãËºâ Word Ê™î</button>
                    <button class="export-btn" onclick="exportToPDF()">üìë ‰∏ãËºâ PDF Ê™î</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ÂÖ®ÂüüËÆäÊï∏
        let currentGoals = {
            cognitive: '',
            skill: '',
            affective: ''
        };

        // Bloom's Ë™çÁü•Â±§Á¥öÂ∞çÊáâ
        const bloomLevels = {
            cognitive: ['Ë®òÊÜ∂', 'ÁêÜËß£', 'ÊáâÁî®', 'ÂàÜÊûê'],
            skill: ['ÊáâÁî®', 'ÂàÜÊûê', 'Ë©ïÈëë', 'ÂâµÈÄ†'],
            affective: ['Êé•Âèó', 'ÂèçÊáâ', 'Ë©ïÂÉπ', 'ÁµÑÁπî', 'ÂÖßÂåñ']
        };

        // Ê†∏ÂøÉÁ¥†È§äÂ∞çÊáâË°®
        const competencyMapping = {
            elementary: {
                chinese: ['A1', 'B1', 'C1'],
                english: ['A1', 'B1', 'C2'],
                math: ['A2', 'B1', 'C1'],
                science: ['A2', 'B2', 'C1'],
                social: ['A1', 'B3', 'C3'],
                arts: ['A1', 'B3', 'C2'],
                pe: ['A1', 'B2', 'C2'],
                tech: ['A2', 'B2', 'C1'],
                other: ['A1', 'B1', 'C1']
            },
            junior: {
                chinese: ['A1', 'B1', 'C1'],
                english: ['A1', 'B1', 'C2'],
                math: ['A2', 'B1', 'C1'],
                science: ['A2', 'B2', 'C1'],
                social: ['A1', 'B3', 'C3'],
                arts: ['A1', 'B3', 'C2'],
                pe: ['A1', 'B2', 'C2'],
                tech: ['A2', 'B2', 'C1'],
                other: ['A1', 'B1', 'C1']
            },
            senior: {
                chinese: ['A1', 'B1', 'C1'],
                english: ['A1', 'B1', 'C2'],
                math: ['A2', 'B1', 'C1'],
                science: ['A2', 'B2', 'C1'],
                social: ['A1', 'B3', 'C3'],
                arts: ['A1', 'B3', 'C2'],
                pe: ['A1', 'B2', 'C2'],
                tech: ['A2', 'B2', 'C1'],
                other: ['A1', 'B1', 'C1']
            }
        };

        // Ë°®ÂñÆÊèê‰∫§‰∫ã‰ª∂
        document.getElementById('courseForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            await generateGoals();
        });

        // Áî¢ÁîüÊïôÂ≠∏ÁõÆÊ®ô‰∏ªÂáΩÊï∏
        async function generateGoals() {
            const formData = new FormData(document.getElementById('courseForm'));
            const courseTitle = formData.get('courseTitle');
            const learningPoints = formData.get('learningPoints');
            const educationLevel = formData.get('educationLevel');
            const subject = formData.get('subject');

            if (!courseTitle || !learningPoints) {
                showError('Ë´ãÂ°´ÂØ´ÂøÖË¶ÅÁöÑË™≤Á®ãË≥áË®ä');
                return;
            }

            // È°ØÁ§∫ËºâÂÖ•ÁãÄÊÖã
            showLoading(true);
            hideError();

            try {
                // ‰ΩøÁî® Hugging Face API Áî¢ÁîüÁõÆÊ®ô
                const prompt = buildPrompt(courseTitle, learningPoints, educationLevel, subject);
                const aiResponse = await callHuggingFaceAPI(prompt);
                
                // Ëß£Êûê AI ÂõûÊáâÔºàÈÄôË£°ÂÅáË®≠ AI ËøîÂõûÊ†ºÂºèÂåñÁöÑÊñáÂ≠óÔºåÂØ¶ÈöõÂèØËÉΩÈúÄÊõ¥Ë§áÈõúËß£ÊûêÔºâ
                const goals = parseAIResponse(aiResponse);
                
                // Êõ¥Êñ∞È°ØÁ§∫
                updateGoalsDisplay(goals);
                updateCompetencyMapping(educationLevel, subject);
                
                showSuccess('ÊïôÂ≠∏ÁõÆÊ®ôÂ∑≤ÊàêÂäüÁî¢ÁîüÔºÅ');
                
            } catch (error) {
                console.error('ÁîüÊàêÂ§±Êïó:', error);
                showError('ÁîüÊàêÊïôÂ≠∏ÁõÆÊ®ôÊôÇÁôºÁîüÈåØË™§ÔºåË´ãÁ®çÂæåÂÜçË©¶');
            } finally {
                showLoading(false);
            }
        }

        // Ëß£Êûê AI ÂõûÊáâÔºàÁ∞°ÂåñËôïÁêÜÔºåÂØ¶ÈöõÈúÄÊ†πÊìöÊ®°ÂûãÂõûÊáâË™øÊï¥Ôºâ
        function parseAIResponse(response) {
            // ÂÅáË®≠ AI ËøîÂõûÈ°û‰ººÊ†ºÂºèÁöÑÊñáÂ≠óÔºåÂØ¶ÈöõÈúÄÊ†πÊìöÊ®°ÂûãË™øÊï¥
            const lines = response.split('\n').filter(line => line.trim());
            return {
                cognitive: lines.find(line => line.startsWith('Ë™çÁü•:'))?.replace('Ë™çÁü•:', '').trim() || 'Â≠∏ÁîüËÉΩÁêÜËß£Ë™≤Á®ãÊ†∏ÂøÉÊ¶ÇÂøµ',
                skill: lines.find(line => line.startsWith('ÊäÄËÉΩ:'))?.replace('ÊäÄËÉΩ:', '').trim() || 'Â≠∏ÁîüËÉΩÊáâÁî®ÊâÄÂ≠∏Ëß£Ê±∫ÂïèÈ°å',
                affective: lines.find(line => line.startsWith('ÊÉÖÊÑè:'))?.replace('ÊÉÖÊÑè:', '').trim() || 'Â≠∏ÁîüËÉΩÂ±ïÁèæÁ©çÊ•µÂ≠∏ÁøíÊÖãÂ∫¶'
            };
        }

        // Êõ¥Êñ∞ÁõÆÊ®ôÈ°ØÁ§∫
        function updateGoalsDisplay(goals) {
            currentGoals = goals;
            
            document.getElementById('cognitiveContent').textContent = goals.cognitive;
            document.getElementById('skillContent').textContent = goals.skill;
            document.getElementById('affectiveContent').textContent = goals.affective;

            // Èö®Ê©üÂàÜÈÖç Bloom's Â±§Á¥öÔºàÂØ¶ÈöõÊáâË©≤Áî± AI ÂàÜÊûêÊ±∫ÂÆöÔºâ
            document.getElementById('cognitiveBloom').textContent = 
                bloomLevels.cognitive[Math.floor(Math.random() * bloomLevels.cognitive.length)];
            document.getElementById('skillBloom').textContent = 
                bloomLevels.skill[Math.floor(Math.random() * bloomLevels.skill.length)];
            document.getElementById('affectiveBloom').textContent = 
                bloomLevels.affective[Math.floor(Math.random() * bloomLevels.affective.length)];

            // È°ØÁ§∫ÁµêÊûúÂçÄÂüü
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('goalsContainer').style.display = 'block';
        }

        // Êõ¥Êñ∞Ê†∏ÂøÉÁ¥†È§äÂ∞çÊáâ
        function updateCompetencyMapping(level, subject) {
            const competencies = competencyMapping[level][subject];
            const competencyNames = {
                'A1': 'Ë∫´ÂøÉÁ¥†Ë≥™ËàáËá™ÊàëÁ≤æÈÄ≤',
                'A2': 'Á≥ªÁµ±ÊÄùËÄÉËàáÂïèÈ°åËß£Ê±∫',
                'A3': 'Ë¶èÂäÉÂü∑Ë°åËàáÂâµÊñ∞ÊáâËÆä',
                'B1': 'Á¨¶ËôüÈÅãÁî®ËàáÊ∫ùÈÄöË°®ÈÅî',
                'B2': 'ÁßëÊäÄË≥áË®äËàáÂ™íÈ´îÁ¥†È§ä',
                'B3': 'ËóùË°ìÊ∂µÈ§äËàáÁæéÊÑüÁ¥†È§ä',
                'C1': 'ÈÅìÂæ∑ÂØ¶Ë∏êËàáÂÖ¨Ê∞ëÊÑèË≠ò',
                'C2': '‰∫∫ÈöõÈóú‰øÇËàáÂúòÈöäÂêà‰Ωú',
                'C3': 'Â§öÂÖÉÊñáÂåñËàáÂúãÈöõÁêÜËß£'
            };

            const competencyList = document.getElementById('competencyList');
            competencyList.innerHTML = '';

            competencies.forEach(code => {
                const item = document.createElement('div');
                item.className = 'competency-item';
                item.innerHTML = `
                    <span>${competencyNames[code]}</span>
                    <span class="competency-code">${code}</span>
                `;
                competencyList.appendChild(item);
            });
        }

        // Á∑®ËºØÁõÆÊ®ô
        function editGoal(type) {
            const contentElement = document.getElementById(`${type}Content`);
            const currentText = contentElement.textContent;
            
            const newText = prompt(`Á∑®ËºØ${type === 'cognitive' ? 'Ë™çÁü•' : type === 'skill' ? 'ÊäÄËÉΩ' : 'ÊÉÖÊÑè'}Â±§Èù¢ÁõÆÊ®ô:`, currentText);
            
            if (newText && newText !== currentText) {
                contentElement.textContent = newText;
                currentGoals[type] = newText;
                showSuccess('ÁõÆÊ®ôÂ∑≤Êõ¥Êñ∞ÔºÅ');
            }
        }

        // ÈáçÊñ∞Áî¢ÁîüÂÄãÂà•ÁõÆÊ®ô
        async function regenerateGoal(type) {
            const contentElement = document.getElementById(`${type}Content`);
            const originalText = contentElement.textContent;
            
            contentElement.textContent = 'ÈáçÊñ∞Áî¢Áîü‰∏≠...';
            
            try {
                // ‰ΩøÁî® Hugging Face API ÈáçÊñ∞Áî¢ÁîüÂñÆ‰∏ÄÁõÆÊ®ô
                const formData = new FormData(document.getElementById('courseForm'));
                const prompt = buildPrompt(
                    formData.get('courseTitle'),
                    formData.get('learningPoints'),
                    formData.get('educationLevel'),
                    formData.get('subject')
                );
                const aiResponse = await callHuggingFaceAPI(prompt);
                const newGoal = parseAIResponse(aiResponse)[type];
                
                contentElement.textContent = newGoal;
                currentGoals[type] = newGoal;
                
                showSuccess(`${type === 'cognitive' ? 'Ë™çÁü•' : type === 'skill' ? 'ÊäÄËÉΩ' : 'ÊÉÖÊÑè'}Â±§Èù¢ÁõÆÊ®ôÂ∑≤ÈáçÊñ∞Áî¢ÁîüÔºÅ`);
                
            } catch (error) {
                contentElement.textContent = originalText;
                showError('ÈáçÊñ∞Áî¢ÁîüÂ§±ÊïóÔºåË´ãÁ®çÂæåÂÜçË©¶');
            }
        }

        // Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞ø
        async function copyToClipboard() {
            const text = formatGoalsForExport();
            
            try {
                await navigator.clipboard.writeText(text);
                showSuccess('ÊïôÂ≠∏ÁõÆÊ®ôÂ∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞øÔºÅ');
            } catch (error) {
                showError('Ë§áË£ΩÂ§±ÊïóÔºåË´ãÊâãÂãïÈÅ∏ÂèñÊñáÂ≠óË§áË£Ω');
            }
        }

        // ÂåØÂá∫ÁÇ∫ Word
        function exportToWord() {
            const content = formatGoalsForExport();
            const blob = new Blob([content], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'ÊïôÂ≠∏ÁõÆÊ®ô.doc';
            link.click();
            
            URL.revokeObjectURL(url);
            showSuccess('Word Ê™îÊ°àÂ∑≤ÈñãÂßã‰∏ãËºâÔºÅ');
        }

        // ÂåØÂá∫ÁÇ∫ PDF
        function exportToPDF() {
            showError('PDF ÂåØÂá∫ÂäüËÉΩÈñãÁôº‰∏≠ÔºåË´ãÂÖà‰ΩøÁî®Ë§áË£ΩÂäüËÉΩ');
        }

        // Ê†ºÂºèÂåñÁõÆÊ®ôÊñáÂ≠ó
        function formatGoalsForExport() {
            const formData = new FormData(document.getElementById('courseForm'));
            const courseTitle = formData.get('courseTitle');
            
            return `ÊïôÂ≠∏ÁõÆÊ®ô - ${courseTitle}

Ë™çÁü•Â±§Èù¢Ôºö
${currentGoals.cognitive}

ÊäÄËÉΩÂ±§Èù¢Ôºö
${currentGoals.skill}

ÊÉÖÊÑèÂ±§Èù¢Ôºö
${currentGoals.affective}

---
Áî¢ÁîüÊôÇÈñìÔºö${new Date().toLocaleString('zh-TW')}
‰ΩøÁî®Â∑•ÂÖ∑ÔºöAI ÊïôÂ≠∏ÁõÆÊ®ôÁî¢ÁîüÂô®`;
        }

        // È°ØÁ§∫ËºâÂÖ•ÁãÄÊÖã
        function showLoading(show) {
            const loadingDiv = document.getElementById('loadingDiv');
            const generateBtn = document.getElementById('generateBtn');
            
            if (show) {
                loadingDiv.classList.add('show');
                generateBtn.disabled = true;
                generateBtn.textContent = '‚è≥ Áî¢Áîü‰∏≠...';
            } else {
                loadingDiv.classList.remove('show');
                generateBtn.disabled = false;
                generateBtn.textContent = '‚ú® Áî¢ÁîüÊïôÂ≠∏ÁõÆÊ®ô';
            }
        }

        // È°ØÁ§∫ÊàêÂäüË®äÊÅØ
        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 3000);
        }

        // È°ØÁ§∫ÈåØË™§Ë®äÊÅØ
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        // Èö±ËóèÈåØË™§Ë®äÊÅØ
        function hideError() {
            document.getElementById('errorMessage').style.display = 'none';
        }

        // È†ÅÈù¢ËºâÂÖ•ÂÆåÊàêÂæåÁöÑÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            updateCompetencyMapping('senior', 'english');
            
            document.getElementById('educationLevel').addEventListener('change', function() {
                const level = this.value;
                const subject = document.getElementById('subject').value;
                updateCompetencyMapping(level, subject);
            });

            document.getElementById('subject').addEventListener('change', function() {
                const level = document.getElementById('educationLevel').value;
                const subject = this.value;
                updateCompetencyMapping(level, subject);
            });
        });

        // Hugging Face API Êï¥ÂêàÂáΩÊï∏
        async function callHuggingFaceAPI(prompt) {
            try {
                // Âæû Render ÂæåÁ´ØÁç≤Âèñ token
                const tokenResponse = await fetch('https://hf-token-backend.onrender.com/api/token');
                if (!tokenResponse.ok) {
                    throw new Error(`ÁÑ°Ê≥ïÁç≤Âèñ API token: ${tokenResponse.status}`);
                }
                const { token } = await tokenResponse.json();

                const MODEL_URL = 'https://api-inference.huggingface.co/models/microsoft/DialoGPT-medium';
                const response = await fetch(MODEL_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        inputs: prompt,
                        parameters: {
                            max_length: 200,
                            temperature: 0.7,
                            do_sample: true
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`API Ë´ãÊ±ÇÂ§±Êïó: ${response.status}`);
                }

                const result = await response.json();
                return result[0].generated_text;

            } catch (error) {
                console.error('Hugging Face API ÂëºÂè´Â§±Êïó:', error);
                showError('ÁîüÊàêÊïôÂ≠∏ÁõÆÊ®ôÂ§±ÊïóÔºåË´ãÊ™¢Êü•Á∂≤Ë∑ØÊàñÁ®çÂæåÂÜçË©¶');
                throw error;
            }
        }

        // Âª∫Êßã AI ÊèêÁ§∫Ë©û
        function buildPrompt(courseTitle, learningPoints, educationLevel, subject) {
            const levelMap = {
                elementary: 'ÂúãÂ∞è',
                junior: 'Âúã‰∏≠', 
                senior: 'È´ò‰∏≠'
            };

            const subjectMap = {
                chinese: 'ÂúãÊñá',
                english: 'Ëã±Êñá',
                math: 'Êï∏Â≠∏',
                science: 'Ëá™ÁÑ∂ÁßëÂ≠∏',
                social: 'Á§æÊúÉ',
                arts: 'ËóùË°ì',
                pe: 'È´îËÇ≤',
                tech: 'ÁßëÊäÄ',
                other: 'ÂÖ∂‰ªñ'
            };

            return `Ë´ãÁÇ∫${levelMap[educationLevel]}${subjectMap[subject]}Ë™≤Á®ã„Äå${courseTitle}„ÄçÁî¢ÁîüÊïôÂ≠∏ÁõÆÊ®ô„ÄÇ
Â≠∏ÁøíÈáçÈªûÔºö${learningPoints}

Ë´ãÁî¢Áîü‰∏âÂÄãÂ±§Èù¢ÁöÑÊïôÂ≠∏ÁõÆÊ®ôÔºö
1. Ë™çÁü•Â±§Èù¢ÔºöÂ≠∏ÁîüËÉΩÁêÜËß£„ÄÅÂàÜÊûê„ÄÅË®òÊÜ∂ÁöÑÁü•Ë≠òÊÄßÁõÆÊ®ô
2. ÊäÄËÉΩÂ±§Èù¢ÔºöÂ≠∏ÁîüËÉΩÂØ¶ÈöõÊìç‰Ωú„ÄÅÊáâÁî®„ÄÅÂâµÈÄ†ÁöÑËÉΩÂäõÊÄßÁõÆÊ®ô  
3. ÊÉÖÊÑèÂ±§Èù¢ÔºöÂ≠∏ÁîüÁöÑÊÖãÂ∫¶„ÄÅÂÉπÂÄºËßÄ„ÄÅÊÉÖÊÑüË°®ÁèæÁõÆÊ®ô

ÊØèÂÄãÁõÆÊ®ôÈÉΩË¶ÅÔºö
- ‰ª•„ÄåÂ≠∏ÁîüËÉΩ„ÄçÈñãÈ†≠
- ÂÖ∑È´îÊòéÁ¢∫ÔºåÂèØËßÄÂØüÂèØË©ïÈáè
- Á¨¶Âêà${levelMap[educationLevel]}Â≠∏ÁîüÁ®ãÂ∫¶
- Â∞çÊáâÈÅ©Áï∂ÁöÑBloomË™çÁü•Â±§Á¥ö

Ë´ãÁî®ÁπÅÈ´î‰∏≠ÊñáÂõûÁ≠îÔºåÊ†ºÂºèÂ¶Ç‰∏ãÔºö
Ë™çÁü•Ôºö[ÁõÆÊ®ôÂÖßÂÆπ]
ÊäÄËÉΩÔºö[ÁõÆÊ®ôÂÖßÂÆπ] 
ÊÉÖÊÑèÔºö[ÁõÆÊ®ôÂÖßÂÆπ]`;
        }
    </script>
</body>
</html>